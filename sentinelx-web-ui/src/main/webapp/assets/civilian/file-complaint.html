<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Complaint - SentinelX Citizen Safety Portal</title>
    <meta name="description" content="File a new safety complaint securely.">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS (Map) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Configuration & Custom Styles -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: {
                            blue: '#1E40AF', // Deep Blue
                            light: '#2563EB', // Brighter Blue
                            dark: '#1E293B', // Dark Slate
                            accent: '#FB923C', // Saffron
                        },
                        status: {
                            pending: '#F59E0B',
                            progress: '#3B82F6',
                            resolved: '#10B981',
                            rejected: '#EF4444'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .glass-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
        }

        /* Leaflet Map Customization */
        .leaflet-container {
            font-family: 'Inter', sans-serif;
            border-radius: 0.75rem;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased font-sans flex flex-col min-h-screen">

    <!-- ==========================================
         1. NAVBAR (Fixed Top)
    =========================================== -->
    <nav class="fixed w-full top-0 z-50 glass-header border-b border-gray-200 shadow-sm h-16 transition-all duration-300">
        <div class="flex items-center justify-between h-full px-4 sm:px-6 lg:px-8 max-w-[1920px] mx-auto">
            
            <!-- Left: Logo -->
            <div class="flex items-center gap-4">
                <a href="index.html" class="flex items-center gap-2 group">
                    <span class="text-3xl transition-transform group-hover:scale-110">üöî</span>
                    <div class="flex flex-col leading-none">
                        <span class="font-bold text-xl text-brand-blue tracking-tight">SentinelX</span>
                        <span class="text-[9px] text-brand-dark uppercase tracking-widest font-semibold">Citizen Portal</span>
                    </div>
                </a>
            </div>

            <!-- Middle: Desktop Nav Links -->
            <div class="hidden md:flex items-center space-x-6 text-sm font-medium text-slate-600">
                <!-- Language Selector -->
                <div class="relative group">
                    <button onclick="toggleLanguage()" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-100 transition">
                        <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" /></svg>
                        <span class="text-sm font-medium text-slate-700" id="current-lang">English</span>
                        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </button>
                    <div id="language-dropdown" class="hidden absolute right-0 mt-2 w-40 bg-white rounded-xl shadow-xl border border-gray-100 z-50 overflow-hidden">
                        <button onclick="changeLanguage('en')" class="w-full text-left px-4 py-3 text-sm hover:bg-blue-50 transition flex items-center gap-2">
                            <span class="text-lg">üá¨üáß</span>
                            <span>English</span>
                        </button>
                        <button onclick="changeLanguage('hi')" class="w-full text-left px-4 py-3 text-sm hover:bg-blue-50 transition flex items-center gap-2 border-t">
                            <span class="text-lg">üáÆüá≥</span>
                            <span>‡§π‡§ø‡§Ç‡§¶‡•Ä</span>
                        </button>
                    </div>
                </div>
                <a href="citizen-dashboard.html" class="hover:text-brand-blue transition" data-i18n="dashboard">Dashboard</a>
                <a href="file-complaint.html" class="text-brand-blue bg-blue-50 px-3 py-1 rounded-full" data-i18n="fileComplaint">File Complaint</a>
                <a href="track-status.html" class="hover:text-brand-blue transition" data-i18n="trackStatus">Track Status</a>
                <a href="emergency.html" class="text-red-600 hover:text-red-700 font-semibold flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    <span data-i18n="emergency">Emergency</span>
                </a>
            </div>

            <!-- Right: Notifications & Profile -->
            <div class="flex items-center gap-4">
                
                <!-- Notification Bell -->
                <div class="relative cursor-pointer group">
                    <div class="p-2 rounded-full hover:bg-slate-100 transition relative">
                        <svg class="w-6 h-6 text-slate-500 group-hover:text-brand-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
                        <span class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white animate-pulse"></span>
                    </div>
                </div>

                <!-- Profile Dropdown -->
                <div class="relative group">
                    <button class="flex items-center gap-2 focus:outline-none">
                        <div class="w-9 h-9 rounded-full bg-brand-blue text-white flex items-center justify-center font-bold text-sm shadow-md ring-2 ring-white ring-offset-2 ring-offset-slate-50">A</div>
                        <span class="hidden sm:block text-sm font-medium text-slate-700">Aditya</span>
                        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </button>
                    <!-- Simple Dropdown (Hover) -->
                    <div class="hidden group-hover:block absolute right-0 mt-0 w-48 bg-white rounded-xl shadow-xl border border-gray-100 z-50 animate-fade-in origin-top-right pt-2">
                        <div class="bg-white rounded-xl overflow-hidden">
                            <div class="px-4 py-3 border-b border-gray-100">
                                <p class="text-sm text-slate-900 font-semibold">Aditya Sharma</p>
                                <p class="text-xs text-slate-500 truncate">aditya.s@sentinelx.gov.in</p>
                            </div>
                            <a href="profile.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-brand-blue transition">My Profile</a>
                            <a href="settings.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-brand-blue transition">Settings</a>
                            <a href="login.html" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition border-t">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ==========================================
         2. MAIN CONTENT
    =========================================== -->
    <main class="flex-grow pt-24 pb-12 px-4 sm:px-6">
        <div class="max-w-3xl mx-auto">
            
            <!-- Header -->
            <div class="text-center mb-8 animate-fade-in">
                <h1 class="text-3xl font-bold text-slate-900 mb-2">File a New Complaint</h1>
                <p class="text-slate-500">Report incidents securely and help keep your community safe.</p>
            </div>

            <!-- Progress Bar -->
            <div class="mb-8 relative">
                <div class="absolute top-1/2 left-0 w-full h-1 bg-gray-200 -z-10 rounded-full"></div>
                <div class="flex justify-between w-full max-w-lg mx-auto">
                    <!-- Step 1 Indicator -->
                    <div class="flex flex-col items-center gap-2 bg-slate-50 px-2 transition-all" id="step-indicator-1">
                        <div class="w-8 h-8 rounded-full bg-brand-blue text-white flex items-center justify-center font-bold text-sm ring-4 ring-white shadow-sm">1</div>
                        <span class="text-xs font-semibold text-brand-blue">Details</span>
                    </div>
                    <!-- Step 2 Indicator -->
                    <div class="flex flex-col items-center gap-2 bg-slate-50 px-2 transition-all opacity-50" id="step-indicator-2">
                        <div class="w-8 h-8 rounded-full bg-gray-300 text-white flex items-center justify-center font-bold text-sm ring-4 ring-white shadow-sm">2</div>
                        <span class="text-xs font-semibold text-gray-500">Location</span>
                    </div>
                    <!-- Step 3 Indicator -->
                    <div class="flex flex-col items-center gap-2 bg-slate-50 px-2 transition-all opacity-50" id="step-indicator-3">
                        <div class="w-8 h-8 rounded-full bg-gray-300 text-white flex items-center justify-center font-bold text-sm ring-4 ring-white shadow-sm">3</div>
                        <span class="text-xs font-semibold text-gray-500">Review</span>
                    </div>
                </div>
            </div>

            <!-- Form Card -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden relative min-h-[500px]">
                
                <!-- Servlet Action: SubmitComplaintServlet, Enctype for file upload -->
                <form id="complaint-form" action="SubmitComplaintServlet" method="POST" enctype="multipart/form-data" onsubmit="submitForm(event)">
                    
                    <!-- STEP 1: Basic Details -->
                    <div id="step-1" class="p-8 space-y-6 animate-fade-in">
                        <h2 class="text-xl font-bold text-slate-800 border-b border-gray-100 pb-2">Incident Details</h2>
                        
                        <!-- Title -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Complaint Title *</label>
                            <input type="text" id="title" name="title" required placeholder="e.g., Stolen Motorbike at MG Road" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-blue focus:border-brand-blue outline-none transition">
                        </div>

                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Category *</label>
                            <div class="relative">
                                <select id="category" name="category" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-blue outline-none appearance-none bg-white">
                                    <option value="" disabled selected>Select Incident Type</option>
                                    <option value="Theft">Theft / Robbery</option>
                                    <option value="Road Accident">Road Accident</option>
                                    <option value="Harassment">Harassment / Stalking</option>
                                    <option value="Missing Person">Missing Person</option>
                                    <option value="Fire Incident">Fire Incident</option>
                                    <option value="Medical Emergency">Medical Emergency</option>
                                    <option value="Domestic Violence">Domestic Violence</option>
                                    <option value="Cyber Crime">Cyber Crime</option>
                                    <option value="Other">Other / Civic Issue</option>
                                </select>
                                <svg class="w-5 h-5 text-gray-400 absolute right-3 top-2.5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </div>

                        <!-- Priority -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Priority Level *</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="cursor-pointer">
                                    <input type="radio" name="priority" value="Low" class="peer hidden">
                                    <div class="py-2 px-3 rounded-lg border border-gray-200 text-center text-sm font-medium text-slate-600 peer-checked:bg-gray-100 peer-checked:border-gray-400 peer-checked:text-slate-900 transition hover:bg-gray-50">
                                        Low
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="priority" value="Medium" class="peer hidden" checked>
                                    <div class="py-2 px-3 rounded-lg border border-gray-200 text-center text-sm font-medium text-slate-600 peer-checked:bg-blue-50 peer-checked:border-brand-blue peer-checked:text-brand-blue transition hover:bg-blue-50">
                                        Medium
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="priority" value="High" class="peer hidden">
                                    <div class="py-2 px-3 rounded-lg border border-gray-200 text-center text-sm font-medium text-slate-600 peer-checked:bg-orange-50 peer-checked:border-orange-500 peer-checked:text-orange-600 transition hover:bg-orange-50">
                                        High
                                    </div>
                                </label>
                                <label class="cursor-pointer" onclick="showEmergencyWarning(true)">
                                    <input type="radio" name="priority" value="Emergency" class="peer hidden" onchange="checkEmergency(this)">
                                    <div class="py-2 px-3 rounded-lg border border-gray-200 text-center text-sm font-medium text-slate-600 peer-checked:bg-red-50 peer-checked:border-red-500 peer-checked:text-red-600 transition hover:bg-red-50">
                                        Emergency
                                    </div>
                                </label>
                            </div>
                            <p id="emergency-warning" class="hidden text-xs text-red-600 mt-2 font-medium animate-pulse">
                                ‚ö†Ô∏è For immediate life-threatening situations, please call 100 or use the SOS button.
                            </p>
                        </div>

                        <!-- Description -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Description *</label>
                            <textarea id="description" name="description" required rows="5" placeholder="Describe the incident in detail..." class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-blue focus:border-brand-blue outline-none transition resize-none"></textarea>
                            <p class="text-xs text-slate-400 text-right mt-1">Min 20 characters</p>
                        </div>
                    </div>

                    <!-- STEP 2: Location & Date -->
                    <div id="step-2" class="hidden p-8 space-y-6 animate-fade-in">
                        <h2 class="text-xl font-bold text-slate-800 border-b border-gray-100 pb-2">Location & Time</h2>
                        
                        <!-- Date & Time -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Incident Date & Time *</label>
                            <input type="datetime-local" id="datetime" name="incidentDate" required class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-blue outline-none text-slate-600">
                        </div>

                        <!-- Address -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Address / Landmark *</label>
                            <input type="text" id="address" name="address" required placeholder="Enter street name, area, or nearest landmark" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-brand-blue outline-none">
                        </div>

                        <!-- Map -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <label class="block text-sm font-medium text-slate-700">Pin Location on Map</label>
                                <button type="button" onclick="getCurrentLocation()" class="text-xs flex items-center gap-1 text-brand-blue hover:underline font-medium">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                    Use My Current Location
                                </button>
                            </div>
                            <!-- Leaflet Map Container -->
                            <div id="map" class="w-full h-64 md:h-80 rounded-xl border border-gray-300 shadow-inner z-0"></div>
                            <p class="text-xs text-slate-500 mt-2">
                                Selected Coordinates: <span id="coords-display" class="font-mono text-slate-700">None</span>
                            </p>
                            <!-- Hidden Inputs for Lat/Lng (Required names for Servlet) -->
                            <input type="hidden" id="lat" name="latitude">
                            <input type="hidden" id="lng" name="longitude">
                        </div>
                    </div>

                    <!-- STEP 3: Evidence & Review -->
                    <div id="step-3" class="hidden p-8 space-y-6 animate-fade-in">
                        <h2 class="text-xl font-bold text-slate-800 border-b border-gray-100 pb-2">Evidence & Review</h2>
                        
                        <!-- File Upload -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Upload Evidence (Images/Video)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:bg-slate-50 transition cursor-pointer relative" id="drop-zone">
                                <!-- Name 'evidence' for file array -->
                                <input type="file" id="file-input" name="evidence" multiple accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="handleFiles(this.files)">
                                <div class="flex flex-col items-center pointer-events-none">
                                    <svg class="w-10 h-10 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <p class="text-sm font-medium text-brand-blue">Click to upload or drag and drop</p>
                                    <p class="text-xs text-slate-400 mt-1">PNG, JPG up to 5MB (Max 5 files)</p>
                                </div>
                            </div>
                            
                            <!-- Preview Grid -->
                            <div id="preview-container" class="grid grid-cols-2 md:grid-cols-5 gap-4 mt-4">
                                <!-- Previews injected here -->
                            </div>
                            <p id="file-count" class="text-xs text-right text-slate-400 mt-1">0/5 uploaded</p>
                        </div>

                        <!-- Summary Review -->
                        <div class="bg-slate-50 rounded-xl p-5 border border-slate-200">
                            <h3 class="text-sm font-bold text-slate-900 uppercase tracking-wide mb-3">Complaint Summary</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between border-b border-gray-200 pb-2">
                                    <span class="text-slate-500">Title:</span>
                                    <span class="font-medium text-slate-800 text-right w-2/3 truncate" id="review-title">-</span>
                                </div>
                                <div class="flex justify-between border-b border-gray-200 pb-2">
                                    <span class="text-slate-500">Category:</span>
                                    <span class="font-medium text-slate-800" id="review-category">-</span>
                                </div>
                                <div class="flex justify-between border-b border-gray-200 pb-2">
                                    <span class="text-slate-500">Priority:</span>
                                    <span class="font-medium text-slate-800" id="review-priority">-</span>
                                </div>
                                <div class="flex justify-between border-b border-gray-200 pb-2">
                                    <span class="text-slate-500">Date/Time:</span>
                                    <span class="font-medium text-slate-800" id="review-date">-</span>
                                </div>
                                <div class="flex justify-between border-b border-gray-200 pb-2">
                                    <span class="text-slate-500">Location:</span>
                                    <span class="font-medium text-slate-800 text-right w-2/3 truncate" id="review-address">-</span>
                                </div>
                                <!-- Added: Coordinates Review -->
                                <div class="flex justify-between border-b border-gray-200 pb-2">
                                    <span class="text-slate-500">Coordinates:</span>
                                    <span class="font-medium text-slate-800" id="review-coords">Not selected</span>
                                </div>
                                <!-- Added: Evidence Count -->
                                <div class="flex justify-between">
                                    <span class="text-slate-500">Evidence:</span>
                                    <span class="font-medium text-slate-800" id="review-evidence">None</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NAVIGATION BUTTONS -->
                    <div class="p-6 bg-gray-50 border-t border-gray-100 flex justify-between items-center rounded-b-2xl">
                        <button type="button" id="prev-btn" onclick="changeStep(-1)" class="hidden px-6 py-2 rounded-lg border border-gray-300 text-slate-600 font-medium hover:bg-white transition shadow-sm">
                            Back
                        </button>
                        <div class="ml-auto">
                            <button type="button" id="next-btn" onclick="changeStep(1)" class="px-8 py-2 rounded-lg bg-brand-blue text-white font-bold hover:bg-blue-700 transition shadow-md flex items-center gap-2">
                                Next Step
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button type="submit" id="submit-btn" class="hidden px-8 py-2 rounded-lg bg-green-600 text-white font-bold hover:bg-green-700 transition shadow-md flex items-center gap-2">
                                Submit Complaint
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            </button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </main>

    <!-- Success Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-xl transform translate-y-24 opacity-0 transition-all duration-300 z-[70] flex items-center gap-3">
        <div class="bg-white/20 p-1 rounded-full">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        </div>
        <div>
            <p class="font-bold text-sm">Complaint Submitted!</p>
            <p class="text-xs text-green-100">Redirecting to Dashboard...</p>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="bg-brand-dark text-white py-8 border-t border-slate-700 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex justify-center space-x-6 text-sm text-slate-400 mb-4">
                <a href="#" class="hover:text-white transition">Privacy Policy</a>
                <span>|</span>
                <a href="#" class="hover:text-white transition">Terms</a>
                <span>|</span>
                <a href="#" class="hover:text-white transition">Help Center</a>
            </div>
            <p class="text-xs text-slate-500">¬© 2026 SentinelX Citizen Safety Portal. A Government of India Initiative.</p>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Page Logic -->
    <script>
        let currentStep = 1;
        let map, marker;
        const uploadedFiles = []; // Store file objects

        // Initialize Map (Lazy load)
        function initMap() {
            if (map) return;
            // Pune Default
            map = L.map('map').setView([18.5204, 73.8567], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            map.on('click', function(e) {
                setMarker(e.latlng.lat, e.latlng.lng);
            });
        }

        function setMarker(lat, lng) {
            if (marker) map.removeLayer(marker);
            marker = L.marker([lat, lng]).addTo(map);
            document.getElementById('lat').value = lat;
            document.getElementById('lng').value = lng;
            document.getElementById('coords-display').innerText = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    map.setView([latitude, longitude], 15);
                    setMarker(latitude, longitude);
                }, () => alert("Location access denied or unavailable."));
            }
        }

        // Emergency Warning Toggle
        function checkEmergency(radio) {
            showEmergencyWarning(radio.value === 'Emergency');
        }

        function showEmergencyWarning(show) {
            const warning = document.getElementById('emergency-warning');
            if(show) warning.classList.remove('hidden');
            else warning.classList.add('hidden');
        }

        // Step Navigation
        function changeStep(direction) {
            if (direction === 1 && !validateStep(currentStep)) return;

            currentStep += direction;
            updateUI();

            // Init map if moving to step 2
            if (currentStep === 2) {
                setTimeout(() => {
                    initMap();
                    map.invalidateSize(); // Fix gray map issue
                }, 100);
            }

            // Populate Review if moving to step 3
            if (currentStep === 3) populateReview();
        }

        function updateUI() {
            // Hide all steps
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.add('hidden');

            // Show current
            document.getElementById(`step-${currentStep}`).classList.remove('hidden');

            // Update Indicators
            for(let i=1; i<=3; i++) {
                const el = document.getElementById(`step-indicator-${i}`);
                const circle = el.querySelector('div');
                const text = el.querySelector('span');

                if (i === currentStep) {
                    el.classList.remove('opacity-50');
                    circle.classList.add('bg-brand-blue');
                    circle.classList.remove('bg-gray-300');
                    text.classList.add('text-brand-blue');
                    text.classList.remove('text-gray-500');
                } else if (i < currentStep) {
                    el.classList.remove('opacity-50');
                    circle.classList.add('bg-green-500'); // Completed
                    circle.classList.remove('bg-brand-blue', 'bg-gray-300');
                    circle.innerHTML = '‚úì';
                } else {
                    el.classList.add('opacity-50');
                    circle.classList.add('bg-gray-300');
                    circle.classList.remove('bg-brand-blue', 'bg-green-500');
                    circle.innerHTML = i;
                    text.classList.remove('text-brand-blue');
                    text.classList.add('text-gray-500');
                }
            }

            // Buttons
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');

            if (currentStep === 1) {
                prevBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            } else if (currentStep === 2) {
                prevBtn.classList.remove('hidden');
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            }
        }

        // Validation
        function validateStep(step) {
            let valid = true;
            if (step === 1) {
                const title = document.getElementById('title');
                const cat = document.getElementById('category');
                const desc = document.getElementById('description');

                if (!title.value.trim()) { title.classList.add('border-red-500'); valid = false; }
                else title.classList.remove('border-red-500');

                if (!cat.value) { cat.classList.add('border-red-500'); valid = false; }
                else cat.classList.remove('border-red-500');

                if (desc.value.length < 20) { desc.classList.add('border-red-500'); valid = false; }
                else desc.classList.remove('border-red-500');
            }
            if (step === 2) {
                const dt = document.getElementById('datetime');
                const addr = document.getElementById('address');
                
                if (!dt.value) { dt.classList.add('border-red-500'); valid = false; }
                else dt.classList.remove('border-red-500');

                if (!addr.value.trim()) { addr.classList.add('border-red-500'); valid = false; }
                else addr.classList.remove('border-red-500');
            }
            return valid;
        }

        // File Handling
        function handleFiles(files) {
            const container = document.getElementById('preview-container');
            const countDisplay = document.getElementById('file-count');

            Array.from(files).forEach(file => {
                if (uploadedFiles.length < 5 && file.type.startsWith('image/')) {
                    uploadedFiles.push(file);
                    
                    const reader = new FileReader();
                    reader.onload = e => {
                        const div = document.createElement('div');
                        div.className = 'relative aspect-square rounded-lg overflow-hidden border border-gray-200 group';
                        div.innerHTML = `
                            <img src="${e.target.result}" class="w-full h-full object-cover">
                            <button type="button" onclick="removeFile(this, '${file.name}')" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow-md hover:bg-red-600 opacity-0 group-hover:opacity-100 transition">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        `;
                        container.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                }
            });

            countDisplay.innerText = `${uploadedFiles.length}/5 uploaded`;
        }

        function removeFile(btn, fileName) {
            const index = uploadedFiles.findIndex(f => f.name === fileName);
            if(index > -1) uploadedFiles.splice(index, 1);
            btn.parentElement.remove();
            document.getElementById('file-count').innerText = `${uploadedFiles.length}/5 uploaded`;
        }

        // Review Populate
        function populateReview() {
            document.getElementById('review-title').innerText = document.getElementById('title').value;
            document.getElementById('review-category').innerText = document.getElementById('category').value;
            document.getElementById('review-priority').innerText = document.querySelector('input[name="priority"]:checked').value;
            
            const dt = new Date(document.getElementById('datetime').value);
            document.getElementById('review-date').innerText = dt.toLocaleString();
            
            document.getElementById('review-address').innerText = document.getElementById('address').value;

            // Updated: Display Coordinates
            const lat = document.getElementById('lat').value;
            const lng = document.getElementById('lng').value;
            document.getElementById('review-coords').innerText = (lat && lng) ? `${parseFloat(lat).toFixed(4)}, ${parseFloat(lng).toFixed(4)}` : "Not pinned";

            // Updated: Display Evidence Count
            const fileCount = uploadedFiles.length;
            document.getElementById('review-evidence').innerText = fileCount > 0 ? `${fileCount} files attached` : "No evidence attached";
        }

        // Submit
        function submitForm(e) {
            // e.preventDefault(); // Commented out to allow actual servlet submission for demo purposes
            // In a real scenario, you might want to prevent default if using AJAX, 
            // but since we want standard form submission to the servlet:
            
            // However, since we are doing a mock visual transition:
            e.preventDefault();
            
            // Show Success Toast
            const toast = document.getElementById('toast');
            toast.classList.remove('opacity-0', 'translate-y-24');
            
            // Disable button
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            btn.innerHTML = 'Submitting...';

            // Redirect mock (Remove this block when connecting to real Servlet)
            setTimeout(() => {
                // If using actual servlet, you'd remove the preventDefault above 
                // and let the form submit naturally. 
                // For this UI demo, we simulate a redirect.
                 window.location.href = 'citizen-dashboard.html';
            }, 2000);
        }

        // Set default date to today
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('datetime').value = now.toISOString().slice(0,16);

        // Language Toggle Function
        function toggleLanguage() {
            const dropdown = document.getElementById('language-dropdown');
            dropdown.classList.toggle('hidden');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const langDropdown = document.getElementById('language-dropdown');
            if (!event.target.closest('.group') && langDropdown) {
                langDropdown.classList.add('hidden');
            }
        });

    </script>
    <script src="../js/language.js"></script>
</body>
</html>